// Utility object similar to ExtJS-style inheritance and object extension
var ZK = {
    // Extend function â€” allows inheritance with optional overrides
    extend: (function () {
        var overrideProps = function (props) {
            for (var key in props) {
                this[key] = props[key];
            }
        };

        var baseConstructor = Object.prototype.constructor;

        return function (superClass, subClass, overrides) {
            // Handle case where only overrides object is provided
            if (typeof subClass === "object") {
                overrides = subClass;
                subClass = superClass;

                superClass =
                    overrides.constructor !== baseConstructor
                        ? overrides.constructor
                        : function () {
                              subClass.apply(this, arguments);
                          };
            }

            var Temp = function () {};
            var superProto = subClass.prototype;

            Temp.prototype = superProto;

            var newProto = (superClass.prototype = new Temp());
            newProto.constructor = superClass;

            // Keep a reference to the parent prototype
            superClass.superclass = superProto;

            if (superProto.constructor === baseConstructor) {
                superProto.constructor = subClass;
            }

            // Allow overriding methods on this class
            superClass.override = function (props) {
                ZK.override(superClass, props);
            };

            newProto.override = overrideProps;

            // Apply the overrides to the subclass
            ZK.override(superClass, overrides);

            // Enable further inheritance
            superClass.extend = function (props) {
                ZK.extend(superClass, props);
            };

            return superClass;
        };
    })(),

    // Override prototype methods or properties
    override: function (cls, props) {
        if (props) {
            var proto = cls.prototype;
            for (var key in props) {
                proto[key] = props[key];
            }
        }
    },

    // Apply properties from one or more objects to a target
    apply: function (target, source, defaults) {
        if (defaults) {
            ZK.apply(target, defaults);
        }

        if (target && source && typeof source === "object") {
            for (var key in source) {
                target[key] = source[key];
            }
        }

        return target;
    },
};

// Generate a random number between 0 and 9999
function getRandomNum() {
    return parseInt(Math.random() * 10000);
}

// Detect browser type
function getBrowserType() {
    if (typeof Worker !== "undefined") {
        return "html5";
    } else if (
        navigator.userAgent.indexOf("MSIE 8.0") > 0 ||
        navigator.userAgent.indexOf("MSIE 9.0") > 0
    ) {
        return "simple";
    } else {
        return "upgradeBrowser";
    }
}

// Encode URL content safely
function encodeContent(content) {
    return encodeURI(content)
        .replace(/&/g, "%26")
        .replace(/\+/g, "%2B")
        .replace(/\s/g, "%20")
        .replace(/#/g, "%23");
}

// Get 2D context for canvas, including IE fallback via G_vmlCanvasManager
function getCanvasContext(canvas) {
    if (typeof window.G_vmlCanvasManager !== "undefined") {
        canvas = window.G_vmlCanvasManager.initElement(canvas);
    }
    return canvas.getContext("2d");
}

// Create a cross-browser XML HTTP request object
function getXMLRequest() {
    var xhr = null;
    if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
    } else if (window.ActiveXObject) {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
    }
    return xhr;
}
